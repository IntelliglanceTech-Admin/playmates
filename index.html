<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Redirecting...</title>
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            // ‚úÖ Extract Hash Fragment (example: #screen=playmate-home)
            const hash = window.location.hash.substring(1); // Remove "#"
            const hashParams = new URLSearchParams(hash);
            const screen = hashParams.get("screen");

            // ‚úÖ Extract session_id from URL Query Params (not hash)
            const urlParams = new URLSearchParams(window.location.search);
            const sessionId = urlParams.get("session_id");

            console.log("üîπ Full URL:", window.location.href);
            console.log("üîπ Extracted Screen:", screen);
            console.log("üîπ Extracted Session ID:", sessionId);

            let deepLink = "";

            // ‚úÖ Handle Different Screens
            if (screen === "playmate-registration") {
                deepLink = sessionId
                    ? `playmates://playmate/playmate-registration?session_id=${sessionId}&status=SUCCESS`
                    : `playmates://playmate/playmate-registration?status=CANCELED`;
            } else if (screen === "playmate-home") {
                deepLink = sessionId
                    ? `playmates://playmate/playmate-home?session_id=${sessionId}&status=SUCCESS`
                    : `playmates://playmate/playmate-home?status=CANCELED`;
            } else {
                document.body.innerHTML = `
                    <h2>Error: Invalid Deep Link</h2>
                    <p>Could not determine where to navigate.</p>
                    <p>üîç Debug Info: <br> <strong>Screen:</strong> ${screen} <br> <strong>Session ID:</strong> ${sessionId}</p>
                `;
                return;
            }

            console.log("üîπ Redirecting to:", deepLink);

            // ‚úÖ Attempt to Open App Deep Link
            window.location.href = deepLink;

            // ‚úÖ Provide a Fallback for Desktop Users
            setTimeout(() => {
                document.body.innerHTML = `
                    <h2>Redirecting...</h2>
                    <p>If the app does not open, <a href="${deepLink}">click here</a>.</p>
                `;
            }, 2000);
        });
    </script>
</head>
<body>
    <h2>Redirecting to app...</h2>
</body>
</html>
